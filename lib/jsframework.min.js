(function(name, altName, definition) { 
  if (typeof module != "undefined") module.exports = definition(window.jquery || require("jquery"));
  else if (typeof define == "function" && typeof define.amd == "object") define(["jquery"], definition);
  else this[name] = this[altName] = definition(jQuery);
}("jframework", "$$", function($) {
  "use strict"
  var DEBUG = false;
var EventEmitter=function(){"use strict";function a(){}function b(a,b){for(var c=a.length;c--;)if(a[c].listener===b)return c;return-1}function c(a){return function(){return this[a].apply(this,arguments)}}var d=a.prototype,e=this,f=e.EventEmitter;return d.getListeners=function(a){var b,c,d=this._getEvents();if(a instanceof RegExp){b={};for(c in d)d.hasOwnProperty(c)&&a.test(c)&&(b[c]=d[c])}else b=d[a]||(d[a]=[]);return b},d.flattenListeners=function(a){var b,c=[];for(b=0;b<a.length;b+=1)c.push(a[b].listener);return c},d.getListenersAsObject=function(a){var b,c=this.getListeners(a);return c instanceof Array&&(b={},b[a]=c),b||c},d.addListener=function(a,c){var d,e=this.getListenersAsObject(a),f="object"==typeof c;for(d in e)e.hasOwnProperty(d)&&-1===b(e[d],c)&&e[d].push(f?c:{listener:c,once:!1});return this},d.on=c("addListener"),d.addOnceListener=function(a,b){return this.addListener(a,{listener:b,once:!0})},d.once=c("addOnceListener"),d.defineEvent=function(a){return this.getListeners(a),this},d.defineEvents=function(a){for(var b=0;b<a.length;b+=1)this.defineEvent(a[b]);return this},d.removeListener=function(a,c){var d,e,f=this.getListenersAsObject(a);for(e in f)f.hasOwnProperty(e)&&(d=b(f[e],c),-1!==d&&f[e].splice(d,1));return this},d.off=c("removeListener"),d.addListeners=function(a,b){return this.manipulateListeners(!1,a,b)},d.removeListeners=function(a,b){return this.manipulateListeners(!0,a,b)},d.manipulateListeners=function(a,b,c){var d,e,f=a?this.removeListener:this.addListener,g=a?this.removeListeners:this.addListeners;if("object"!=typeof b||b instanceof RegExp)for(d=c.length;d--;)f.call(this,b,c[d]);else for(d in b)b.hasOwnProperty(d)&&(e=b[d])&&("function"==typeof e?f.call(this,d,e):g.call(this,d,e));return this},d.removeEvent=function(a){var b,c=typeof a,d=this._getEvents();if("string"===c)delete d[a];else if(a instanceof RegExp)for(b in d)d.hasOwnProperty(b)&&a.test(b)&&delete d[b];else delete this._events;return this},d.removeAllListeners=c("removeEvent"),d.emitEvent=function(a,b){var c,d,e,f,g=this.getListenersAsObject(a);for(e in g)if(g.hasOwnProperty(e))for(d=g[e].length;d--;)c=g[e][d],c.once===!0&&this.removeListener(a,c.listener),f=c.listener.apply(this,b||[]),f===this._getOnceReturnValue()&&this.removeListener(a,c.listener);return this},d.trigger=c("emitEvent"),d.emit=function(a){var b=Array.prototype.slice.call(arguments,1);return this.emitEvent(a,b)},d.setOnceReturnValue=function(a){return this._onceReturnValue=a,this},d._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},d._getEvents=function(){return this._events||(this._events={})},a.noConflict=function(){return e.EventEmitter=f,a},a}.call({}),utils=function(){var a={},b=function(a){return a.match(/\{.*\}/)};return a.removeEmptyInArray=function(a){for(var b=a.length-1;b>=0;b--)a[b]||"number"==typeof a[b]||a.splice(b,1);return a},a.matchRoute=function(a,c){if("*"===c)return!0;var d=a.split("/"),e=c.split("/");if(this.removeEmptyInArray(d),this.removeEmptyInArray(e),d.length!==e.length)return!1;for(var f=0;f<d.length;f++)if(d[f]!==e[f]&&!b(e[f]))return!1;return!0},a.getParams=function(a,c){var d={},e=a.split("/"),f=c.split("/");return f.forEach(function(a,c){b(a)&&(d[a.replace(/\{|\}/g,"")]=e[c])}),d},a.compileRoute=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a=a.replace("{"+c+"}",b[c]));return a},a.merge=function(a,b){for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b},a.isObject=function(a){return"object"==typeof a&&null!==a&&!Array.isArray(a)},a.deepCompare=function(b,c){var d=function(b,c){if(Array.isArray(b)||a.isObject(b)){var d=a.deepComparison(b,c);if(!d)return!1}else if(b!==c)return!1;return!0};if(Array.isArray(b)&&Array.isArray(c)&&b!==c){for(var e=0;e<b.length;e++){var f=d(b[e],c[e]);if(!f)return!1}return!0}if(a.isObject(b)&&a.isObject(b)&&b!==c){for(var g in b)if(b.hasOwnProperty(g)){var f=d(b[g],c[g]);if(!f)return!1}return!0}return!1},a}(),config=function(){var a={json:!0,baseUrl:"",popstate:!1,autoRoute:!0};return a}(),jframeworkRoute=function(a,b){var c={},d=[],e=!0;return c.triggerRoute=function(a,d,f){"string"==typeof a.callback?c.resolveRoute(a.callback):b.popstate?e||a.path!==location.pathname?(window.history.pushState({},"",d),a.callback(f),e=!1):window.history.replaceState({},"",d):(e||a.path!==location.pathname)&&(location.href=b.baseUrl+"/#"+d,a.callback(f),e=!1)},c.resolveRoute=function(b){for(var e=0;e<d.length;e++){var f=d[e];if(a.matchRoute(b,f.path)){var g=a.getParams(b,f.path);return c.triggerRoute(f,a.compileRoute(f.path,g),g)}}throw new Error("No routes match "+b)},c.route=function(a,c){if(2!==arguments.length)throw new Error("You are passing the wrong arguments to createRoute()");d.push({path:b.popstate?b.baseUrl+a:a,callback:c})},c.goTo=function(a){$(function(){c.resolveRoute(b.popstate?b.baseUrl+a:a)})},c.deferTo=function(a){return function(){c.goTo(a)}},c}(utils,config),jframework=function(a,b,c){var d={},e=[];d.render=function(a,b){var d=e.reduce(function(a,c){return b===c.target?c:a},null);d&&d.component._constr===a._constr&&!c.deepCompare(d.component.props,a.props)?(d.component.props=a.props,d.component.update()):d&&d.component._constr===a._constr||($(b).html(a._init()),a.$el.on("destroy",a._remove.bind(a)),e.push({component:a,target:b}))};var f=0;return d.generateId=function(a){return a?a+"_"+f++:""+f++},d.config=function(a){return a?(c.merge(a,b),void(b.json&&$.ajaxSetup({}))):b},d.run=function(){$("body").on("click","a",function(b){b.preventDefault(),a.goTo(b.currentTarget.href.substr(location.origin.length))}),b.popstate&&(window.onpopstate=function(){a.resolveRoute(location.pathname)}),a.goTo(location.pathname.substr(b.baseUrl.length))},d.path=function(){return b.popstate?location.pathname.substr(b.baseUrl.length):location.hash.substr(1)},d.addClass=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&a[c]&&b.push(c);return b.length?' class="'+b.join(" ")+'"':""},$.event.special.destroy={remove:function(a){if(a.handler)for(var b=a.handler(),c=0;c<e.length;c++)if(e[c].component===b)return void e.splice(c,1)}},$(function(){!window.define&&b.autoRoute&&d.run()}),d}(jframeworkRoute,config,utils),jframeworkAction=function(a){var b={},c=function(){var b=function(){var a=Array.prototype.slice.call(arguments,0);b.emit.apply(b,["trigger"].concat(a))};for(var c in a.prototype)a.prototype.hasOwnProperty(c)&&(b[c]=a.prototype[c]);return b};return b.action=function(){if(Array.isArray(arguments[0])){var a={};return arguments[0].forEach(function(b){a[b]=c()}),a}if(!arguments.length)return c();throw new Error("action() takes no arguments or an array of strings")},b}(EventEmitter),jframeworkComponent=function(a){var b={},c=[];return b.createDomNodeRepresentation=function(a){return"object"==typeof a?a:(a+="",a.match(/<.*\/>/)?{hasChildren:!1,node:$(a)}:a.match(/<.*>.*<\/.*>/)?{hasChildren:!1,node:$(a)}:a.match(/<\/.*>/)?{hasChildren:!1,node:null}:a.match(/<.*>/)?{hasChildren:!0,node:$(a)}:"string"==typeof a?{hasChildren:!1,node:$(document.createTextNode(a))}:void 0)},b.jComponent=function(a){this._preRenders=[],this._isRendering=!1,this._components=[],this._renders=[],this._attributes=[],this._listeners=[],this._plugins=[],this._objectListeners=[],this._renderArgs=[],this.props=a||{}},b.jComponent.prototype={constructor:b.jComponent,_init:function(){if(this._renders=this._renderCallback(),!this._renders)throw new Error("You are not returning a template from the render function");this._preRenders=this._renders;var a=this._compile(this._renders,!0);return this._addListeners(a),this.$el=a,a},_remove:function(){return this._objectListeners.forEach(function(a){a.target.removeListener(a.type,a.cb)}),this._components.forEach(function(a){a._remove()}),this.$el.remove(),this},_flatten:function(a){return a.reduce(function(a,b){return a=a.concat(b)},[])},_compile:function(a,c){for(var d=$(),e=0;e<a.length;e++)Array.isArray(a[e])&&a[e].isChildArray?d.last().append(this._compile(a[e])):Array.isArray(a[e])?d=d.add(this._compile(this._flatten(a[e]))):a[e]instanceof b.jComponent?(d=d?d.add(a[e]._init()):a[e]._init(),c&&this._components.push(a[e])):d=d?d.add(a[e]):a[e];return d},_render:function(){this._isRendering=!0,this._renders=this._renderCallback.call(this),this._isRendering=!1},_addListeners:function(a){var b=this;this._listeners.forEach(function(c){c.target?a.on(c.type,c.target,function(a){c.cb.call(b,$(a.currentTarget),a)}):a.on(c.type,function(a){c.cb.call(b,$(a.currentTarget),a)})})},_addPlugins:function(){this._plugins.forEach(function(a){a.target?this.$(a.target)[a.name](a.options):this.$el[a.name](a.options)},this)},_template:function(){for(var a=Array.prototype.slice.call(arguments,0),c=[],d=c,e=[c],f=0;f<a.length;f++){var g=a[f],h=b.createDomNodeRepresentation(g);if("object"==typeof g)d.push(h);else{if(!h.node){e.pop(),d=e[e.length-1];continue}d.push(h.node)}if(h.hasChildren){var i=[];i.isChildArray=!0,d.push(i),d=i,e.push(i)}}return c},_diff:function(c,d,e){c=c||this._renders,d=d||this._preRenders;for(var f=0;f<c.length;f++){if(Array.isArray(c[f])&&c[f].isChildArray)this._diff(c[f],d[f],d[f-1]);else if(Array.isArray(c[f]))if(c[f].length>d[f].length){var g=c[f].map(function(a){return a[0]instanceof b.jComponent?a[0].$el.attr("id"):a[0].attr("id")}),h=d[f].map(function(a){return a[0]instanceof b.jComponent?a[0].$el.attr("id"):a[0].attr("id")});g.forEach(function(a,b){-1===h.indexOf(a)&&b>=d[f].length?(e.append(this._compile(c[f][b])),d[f].push(c[f][b])):-1===h.indexOf(a)&&(c[f][b][0].insertBefore(this._compile(d[f][b])),d[f].splice(b,0,c[f][b]))},this)}else if(c[f].length<d[f].length)for(var g=c[f].map(function(a){return a[0]instanceof b.jComponent?a[0].$el.attr("id"):a[0].attr("id")}),h=d[f].map(function(a){return a[0]instanceof b.jComponent?a[0].$el.attr("id"):a[0].attr("id")}),i=h.length-1;i>=0;i--){var j=h[i];-1===g.indexOf(j)&&(d[f][i][0]instanceof b.jComponent?d[f][i][0]._remove():d[f][i][0].remove(),d[f].splice(i,1))}else this._diff(c[f],d[f]);else if(c[f]instanceof b.jComponent){var k=d[f]._props,l=c[f].props;d[f].props=l;var m=!a.deepCompare(k,l);m&&d[f].update()}else 3===c[f].get(0).nodeType&&c[f].text()!==d[f].text()&&(d[f].get(0).nodeValue=c[f].text());if(c[f]instanceof jQuery){var n=d[f].get(0).attributes,o=c[f].get(0).attributes;if(o&&Object.keys(n).length<=Object.keys(o).length)for(var p in o)!o.hasOwnProperty(p)||!o[p].name||n[p]&&o[p].value===n[p].value||("checked"===o[p].name&&(d[f].get(0).checked=!0),d[f].attr(o[p].name,o[p].value||!0));else if(n)for(var p in n)n.hasOwnProperty(p)&&n[p].name&&!o[p]?d[f].removeAttr(n[p].name):o.hasOwnProperty(p)&&o[p].name&&o[p].value!==n[p].value&&d[f].attr(o[p].name,o[p].value||!0)}}},$:function(a){return this.$el.find(a)},update:function(){this._render(),this._compile(this._renders),this._diff()},attribute:function(){},render:function(a){this._renderCallback=a},listenTo:function(a,b,c){if(this._isRendering)throw new Error("Do not run listenTo() in your render callback");"object"==typeof a?(c=b.bind(this),b=a,a="update",b.on(a,c),this._objectListeners.push({type:a,target:b,cb:c})):this._listeners.push({type:a,target:"function"==typeof b?null:b,cb:"function"==typeof c?c:b})},plugin:function(){if(this._isRendering)throw new Error("Do not run plugin() in your render callback");var a=arguments[0],b="string"==typeof arguments[1]?arguments[1]:null,c=3===arguments.length?arguments[2]:arguments[1];this._plugins.push({name:a,target:b,options:c})}},b.component=function(a){return function(d){var e=new b.jComponent(d);return a.call(e,e._template.bind(e)),e._constr=a,c.push(e),e}},b}(utils),jframeworkState=function(a){var b=function(c){var d=function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b])};d.prototype=Object.create(a.prototype);var e=function(){this._exports=null,this.exports=function(a){this._exports=new d(a)}};e.prototype=b.prototype;var f=new e;return c.call(f,f.flush.bind(f))||{},f._exports};return b.prototype={listenTo:function(a,b){this._listeners=this._listeners||[],a.on("trigger",b.bind(this))},flush:function(){this._exports.emit("update")}},b}(EventEmitter),jframeworkComponents=function(a,b){var c=(a.component,{});return c}(jframeworkComponent,jframeworkRoute); return {
   render: jframework.render,
   component: jframeworkComponent.component,
   state: jframeworkState,
   route: jframeworkRoute.route,
   action: jframeworkAction.action,
   generateId: jframework.generateId,
   run: jframework.run,
   path: jframework.path,
   components: jframeworkComponents,
   config: jframework.config,
   addClass: jframework.addClass,
 };

}));